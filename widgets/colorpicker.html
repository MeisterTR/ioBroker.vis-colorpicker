<!--<script type="text/javascript" src="widgets/colorpicker/js/jscolor.js"></script>-->
<link rel="stylesheet" type="text/css" href="widgets/colorpicker/css/farbtastic.css" />
<link rel="stylesheet" type="text/css" href="widgets/colorpicker/css/spectrum.css" />

<script type="text/javascript" src="widgets/colorpicker/js/farbtastic.js"></script>
<script type="text/javascript" src="widgets/colorpicker/js/spectrum.js"></script>

<script type="text/javascript">
    
    if (vis.language == 'de'){
        var localization = $.spectrum.localization["de"] = {
            cancelText: "Abbrechen",
            chooseText: "Wählen",
            clearText: "Farbauswahl zurücksetzen",
            noColorSelectedText: "Keine Farbe ausgewählt",
            togglePaletteMoreText: "Mehr",
            togglePaletteLessText: "Weniger"
        };
        $.extend($.fn.spectrum.defaults, localization);
    } else if (vis.language == 'ru'){
        var localization = $.spectrum.localization["ru"] = {
            cancelText: "отмена",
            chooseText: "выбрать",
            clearText: "сбросить",
            noColorSelectedText: "никакой цвет не выбран",
            togglePaletteMoreText: "больше",
            togglePaletteLessText: "меньше"
        };
        $.extend($.fn.spectrum.defaults, localization);
    }

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "red-oid":      {"en": "Red ID",    "de": "Rot ID",     "ru": "Красный ID"},
            "green-oid":    {"en": "Green ID",  "de": "Grün ID",    "ru": "Зелёный ID"},
            "blue-oid":     {"en": "Blue ID",   "de": "Blau ID",    "ru": "Синий ID"},
            "divisor":      {"en": "divisor",   "de": "Divisor",    "ru": "Делитель"}
        });
    }

    vis.binds.colorpicker = {
        /*jscolor: function (el) {
            var myPicker = new jscolor.color(document.getElementById(jQuery(el).parent().attr('id')+"_jscolor"), {})

        },*/
        rgb2hex: function (r,g,b) {
            return "#" + ("0" + r.toString(16)).slice(-2) + ("0" + g.toString(16)).slice(-2) + ("0" + b.toString(16)).slice(-2);
        },
        hex2rgb: function (hex) {
            var r = parseInt(hex.substr(1, 2), 16);
            var g = parseInt(hex.substr(3, 2), 16);
            var b = parseInt(hex.substr(5, 2), 16);
            return {r: r, g: g, b: b};
        },
        farbtastic: function (el, r_id, g_id, b_id, factor) {
            var $this = jQuery(el);
            $this.hide();

            r_id = r_id || 'nothing_selected';
            g_id = g_id || 'nothing_selected';
            b_id = b_id || 'nothing_selected';

            var ft = $.farbtastic($this.prev(), function () {
                var color = vis.binds.colorpicker.hex2rgb(this.color);
                var r = (parseFloat(color.r) / factor).toFixed(3);
                var g = (parseFloat(color.g) / factor).toFixed(3);
                var b = (parseFloat(color.b) / factor).toFixed(3);
                if (!isNaN(r) && !isNaN(g) && !isNaN(b)) {
                    if (r_id && r_id !== 'nothing_selected') {
                        vis.states[r_id + '.val'] = r;
                        vis.setValue(r_id, r);
                    }
                    if (g_id && g_id !== 'nothing_selected'){
                        vis.states[g_id + '.val'] = g;
                        vis.setValue(g_id, g);
                    }
                    if (b_id && b_id !== 'nothing_selected') {
                        vis.states[b_id + '.val'] = b;
                        vis.setValue(b_id, b);
                    }
                }
            });

            var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
            var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
            var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
            ft.setColor(vis.binds.colorpicker.rgb2hex(r, g, b));

            vis.states.bind(r_id + '.val', function(e, newVal, oldVal) {
                var r = parseInt(parseFloat(newVal) * factor, 10);
                var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
                var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
                ft.setColor(vis.binds.colorpicker.rgb2hex(r, g, b));
            });
            vis.states.bind(g_id + '.val', function(e, newVal, oldVal) {
                var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
                var g = parseInt(parseFloat(newVal) * factor, 10);
                var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
                ft.setColor(vis.binds.colorpicker.rgb2hex(r, g, b));
            });
            vis.states.bind(b_id + '.val', function( e, newVal, oldVal ) {
                var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
                var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
                var b = parseInt(parseFloat(newVal) * factor, 10);
                ft.setColor(vis.binds.colorpicker.rgb2hex(r, g, b));
            });
        },
        spectrum: function (el, r_id, g_id, b_id, factor) {
            r_id = r_id || 'nothing_selected';
            g_id = g_id || 'nothing_selected';
            b_id = b_id || 'nothing_selected';

            var $this = jQuery(el);

            $this.spectrum({
                preferredFormat: "rgb"
            });

            var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
            var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
            var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
            $this.spectrum("set", {r: r, g: g, b: b});

            vis.states.bind(r_id + '.val', function( e, newVal, oldVal ) {
                var r = parseInt(parseFloat(newVal) * factor, 10);
                var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
                var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
                $this.spectrum("set", {r: r, g: g, b: b});
            });
            vis.states.bind(g_id + '.val', function( e, newVal, oldVal ) {
                var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
                var g = parseInt(parseFloat(newVal) * factor, 10);
                var b = parseInt(parseFloat(vis.states[b_id + '.val'] || 0) * factor, 10);
                $this.spectrum("set", {r:r, g:g, b:b});
            });
            vis.states.bind(b_id + '.val', function( e, newVal, oldVal ) {
                var r = parseInt(parseFloat(vis.states[r_id + '.val'] || 0) * factor, 10);
                var g = parseInt(parseFloat(vis.states[g_id + '.val'] || 0) * factor, 10);
                var b = parseInt(parseFloat(newVal) * factor, 10);
                $this.spectrum("set", {r:r, g:g, b:b});
            });
            $this.change(function() {
                console.log($this.val());
                var color = $this.spectrum('get').toRgb();
                var r = (parseFloat(color.r) / factor).toFixed(3);
                var g = (parseFloat(color.g) / factor).toFixed(3);
                var b = (parseFloat(color.b) / factor).toFixed(3);
                if (!isNaN(r) && !isNaN(g) && !isNaN(b)) {
                    if (r_id && r_id !== 'nothing_selected') {
                        vis.states[r_id + '.val'] = r;
                        vis.setValue(r_id, r);
                    }
                    if (g_id && g_id !== 'nothing_selected'){
                        vis.states[g_id + '.val'] = g;
                        vis.setValue(g_id, g);
                    }
                    if (b_id && b_id !== 'nothing_selected') {
                        vis.states[b_id + '.val'] = b;
                        vis.setValue(b_id, b);
                    }
                }
            });
        }
    };
</script>

<script id="tplRGBSpectrum"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplRGBSpectrum.png"></img>'
        data-vis-set="colorpicker"
        data-vis-type="ctrl,color"
        data-vis-name="RGB spectrum"
        data-vis-attrs="red-oid;green-oid;blue-oid;divisor[255]">
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input id="<%= this.data.attr('wid') %>_spectrum" value="" <%= (el) -> vis.binds.colorpicker.spectrum(el, data.attr('red-oid'), data.attr('green-oid'), data.attr('blue-oid'), data.attr('divisor')) %>>
        </div>
    </div>
</script>


<script id="tplRGBFarbtastic"
        class="vis-tpl" 
        type="text/ejs"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplRGBFarbtastic.png"></img>'
        data-vis-set="colorpicker"
        data-vis-name="ctrl - rgb farbtastic" 
        data-vis-attrs="red-oid;green-oid;blue-oid;divisor[255]">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 196px; height: 196px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div id="<%= this.data.attr('wid') %>_farbtastic"></div>
            <input id="<%= this.data.attr('wid') %>_farbtastic_input" value="" <%= (el) -> vis.binds.colorpicker.farbtastic(el, data.attr('red-oid'), data.attr('green-oid'), data.attr('blue-oid'), data.attr('divisor')) %>>
        </div>
    </div>
</script>

        <!--

<script type="text/ejs" id="tplJscolor" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="jscolor" data-vis-attrs="hue_id;sat_id;bri_id">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input id="<%= this.data.attr('wid') %>_jscolor">
            <div class="popup-helper" <%= (el) -> vis.binds.colorpicker.jscolor(el) %>></div>
        </div>
    </div>
</script>





<script type="text/ejs" id="tplDmxFarbtastic" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="dmx_ctrl - farbtastic (unfertig)" data-vis-attrs="program_id;red_channel;green_channel;blue_channel">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 195px; height: 195px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div id="<%= this.data.attr('wid') %>_farbtastic"></div>
            <input id="<%= this.data.attr('wid') %>_farbtastic_input" value=""  <%= (el) -> vis.binds.colorpicker.farbtastic(el) %>>
        </div>
    </div>
</script>

<script type="text/ejs" id="tplFarbtasticDialog" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="hue_ctrl - farbtastic jqui Dialog (unfertig)" data-vis-attrs="lamp_id;program_id;hue_id;sat_id;bri_id">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div id="<%= this.data.attr('wid') %>_farbtastic"></div>
            <input id="<%= this.data.attr('wid') %>_farbtastic_input" value="" <%= (el) -> vis.binds.colorpicker.farbtastic(el) %>>
        </div>
    </div>
</script>

<script type="text/ejs" id="tplDmxFarbtasticDialog" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="dmx_ctrl - farbtastic jqui Dialog (unfertig)" data-vis-attrs="program_id;red_channel;green_channel;blue_channel">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 195px; height: 195px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div id="<%= this.data.attr('wid') %>_farbtastic"></div>
            <input id="<%= this.data.attr('wid') %>_farbtastic_input" value=""  <%= (el) -> vis.binds.colorpicker.farbtastic(el) %>>
        </div>
    </div>
</script>


<script type="text/ejs" id="tplSpectrum" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="hue_ctrl - spectrum (unfertig)" data-vis-attrs="lamp_id;program_id;hue_id;sat_id;bri_id">
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input id="<%= this.data.attr('wid') %>_spectrum" value="" <%= (el) -> vis.binds.colorpicker.spectrum(el) %>>
        </div>
    </div>
</script>


<script type="text/ejs" id="tplDmxSpectrum" class="vis-tpl" data-vis-set="colorpicker" data-vis-name="dmx_ctrl - spectrum (unfertig)" data-vis-attrs="program_id;red_channel;green_channel;blue_channel">
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input id="<%= this.data.attr('wid') %>_spectrum" value="" <%= (el) -> vis.binds.colorpicker.spectrum(el) %>>
        </div>
    </div>
</script>


-->
